<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Usuários - CRUD</title>
    <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 30px auto;
    }

    input,
    button {
      margin: 5px 0;
      padding: 6px;
      width: 100%;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th,
    td {
      padding: 8px;
      border: 1px solid #ccc;
      text-align: left;
    }

    .actions {
      display: flex;
      gap: 10px;
    }

    /* Define o contêiner como um layout flexível */
    .container-botoes {
        display: flex;
        /* Adiciona um espaço entre os botões */
        gap: 10px; 
        /* Opcional: Centraliza os botões no contêiner */
        justify-content: center; 
    }
    .header-com-botao {
        /* 1. Ativa o Flexbox para alinhar os itens na mesma linha */
        display: flex;
        
        /* 2. Alinha verticalmente os itens no centro (útil se o botão for menor que o H2) */
        align-items: center; 
        
        /* 3. Distribui o espaço disponível entre e ao redor dos itens. */
        /* 'space-between' empurra o H2 para a esquerda e o botão para a direita */
        justify-content: space-between; 
        
        /* Opcional: Para visualizar o contêiner */
        /* border-bottom: 1px solid #ccc; */
        padding-bottom: 10px;
    }
  </style>

</head>
<body>

  <h1>Cadastro de Clientes</h1>

  <div id="areaEdicao" hidden>
 <!-- <form id="clienteForm"> -->
    <input type="hidden" id="id" />

    <label for="nome">Nome:</label><br>
    <input type="text" id="nome" placeholder="Nome" required/>

    <label for="endereco">Endereço:</label><br>
    <input type="text" id="endereco" placeholder="Endereço"/>

    <label for="cidade">Cidade:</label><br>
    <input type="text" id="cidade" placeholder="Cidade"  />

    <label for="nome">UF:</label><br>
    <input type="text" id="uf" placeholder="UF" />

    <label for="cep">CEP:</label><br>
    <input type="text" id="cep" placeholder="CEP" />

    <label for="email">eMail:</label><br>
    <input type="email" id="email" placeholder="Email" />

        
    <label for="telefone">Telefone:</label><br>
    <input type="text" id="telefone" placeholder="Telefone" />

    <label for="valorcredito">Valor do Crédito:</label><br>
    <input type="text" id="valorcredito" placeholder="Valor do Crédito" />
    

    <div class="container-botoes">
        <!-- <button type="submit">Salvar</button> -->

        <button onclick="salvarCliente(1)">Salvar</button>
        <button onclick="ocultarFormulario()">Cancelar</button>
    </div>
   <!-- </form> -->
  </div>

  <div id="areaLista">
    <div class="header-com-botao">
        <h2>Lista Completa de Clientes</h2>
        <button id="btnteste" onclick="novoCliente()">Inclusão</button>
    </div>
  
  <table id=>
    <thead>
      <tr>
        <th>Nome</th>
        <th>Cidade</th>
        <th>UF</th>
        <th>Crédito</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody id="clientTable"></tbody>
  </table>
  </div>
  


  

  <script>
      const API_URL = "http://localhost:3000/clientes";

      async function carregarClientes() {
          const res = await fetch(API_URL);
          const clientes = await res.json();
          const tabela = document.getElementById("clientTable");
          tabela.innerHTML = "";

          clientes.forEach(cliente => {
          const row = document.createElement("tr");
          row.innerHTML = `
              <td>${cliente.nome}</td>
              <td>${cliente.cidade}</td>
              <td>${cliente.uf}</td>
              <td>${cliente.valorcredito}</td>
              <td class="actions">
              <button onclick="editarCliente(${cliente.id})">Editar</button>
              <button onclick="excluirCliente(${cliente.id})">Excluir</button>
              </td>
          `;
          tabela.appendChild(row);
          });
      }

      async function salvarCliente(e) {
          if (criticaCliente()) {
          
            //e.preventDefault();

            // Cria json com os dados a seren enviados

            const id = document.getElementById("id").value;
            const data = {
            nome: document.getElementById("nome").value,
            endereco: document.getElementById("endereco").value,
            cidade: document.getElementById("cidade").value,
            uf: document.getElementById("uf").value,
            cep: document.getElementById("cep").value,
            email: document.getElementById("email").value,
            telefone:document.getElementById("telefone").value,
            valorcredito:document.getElementById("valorcredito").value

            };

            // se existir id então é atualização, senão inclusão
            // Post inserir 
            // Put Atualizar 

            let metodo = ""
            let url = ""
            if (id > 0){
                metodo = "PUT"
                url = `${API_URL}/${id}` 
            } else {
                metodo = "POST"
                url =  API_URL;
            }
            //const metodo = id ? "PUT" : "POST";
            //const url = id ? `${API_URL}/${id}` : API_URL;

            console.log(`id:${id}`)
            console.log(`metodo:${metodo}`)
            
            await fetch(url, {
            method: metodo,
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
            });

            // document.getElementById("clienteForm").reset();

            // Recarrega a Grade a tela
            ocultarFormulario();
            carregarClientes();
       }
      }

      async function editarCliente(id) {

          // Obtem os dados de um determinado cliente
          const res = await fetch(`${API_URL}/${id}`, { method: "GET" });
          const cliente = await res.json();

          document.getElementById("id").value = id;
          document.getElementById("nome").value = cliente.nome;
          document.getElementById("endereco").value = cliente.endereco;
          document.getElementById("cidade").value = cliente.cidade;
          document.getElementById("uf").value = cliente.uf;
          document.getElementById("cep").value = cliente.cep;
          document.getElementById("email").value = cliente.email;
          document.getElementById("telefone").value = cliente.telefone;
          document.getElementById("valorcredito").value = cliente.valorcredito;

          exibirFormulario()



      }

      async function excluirCliente(id) {
          if (confirm("Deseja excluir este cliente?")) {
          await fetch(`${API_URL}/${id}`, { method: "DELETE" });
          carregarClientes();
          }
      }

      function exibirFormulario() {

        document.getElementById("areaEdicao").hidden = false
        document.getElementById("areaLista").hidden = true
      }

      function ocultarFormulario() {
        document.getElementById("areaEdicao").hidden = true
        document.getElementById("areaLista").hidden = false
      }

      function limparCamposFormulario() {
          document.getElementById("id").value = 0;
          document.getElementById("nome").value = "";
          document.getElementById("endereco").value = "";
          document.getElementById("cidade").value = "";
          document.getElementById("uf").value = "";
          document.getElementById("cep").value = "";
          document.getElementById("email").value = "";
          document.getElementById("telefone").value = "";
          document.getElementById("valorcredito").value = "";

      }

      function novoCliente() {
        limparCamposFormulario();
        document.getElementById("id").value = 0;
        exibirFormulario();
      }

      function criticaCliente() {
          if (document.getElementById("nome").value == "") {
            alert("Nome do Cliente não fornecido.");
            return false;
          }
          if (document.getElementById("endereco").value == "") {
            alert("Endereço do Cliente não fornecido.");
            return false;
          }
          
          if (document.getElementById("cidade").value == "") {
            alert("Cidade do Cliente não fornecida.");
            return false;
          };
          if (document.getElementById("uf").value == "") {
            alert("UF do Cliente não fornecido.");
            return false;
          };
          if (document.getElementById("cep").value == "") {
            alert("CEP do Cliente não fornecido.");
            return false;
          };
          if (document.getElementById("email").value == "") {
            alert("eMail do Cliente não fornecido.");
            return false;
          };
          if (document.getElementById("telefone").value == "") {
            alert("Telefone do Cliente não fornecido.");
            return false;
          };
          if (document.getElementById("valorcredito").value == "") {
            alert("Valor do Crédito do Cliente não fornecido.");
            return false;
          };
          return true;

      }

      //document.getElementById("clienteForm").addEventListener("submit", salvarCliente);
      carregarClientes();


  </script> 
  

</body>
</html>